/*
 * RealtimeMonitor
 * https://www.github.com/kloverde/js-RealtimeMonitor
 *
 * Copyright (c) 2018, Kurtis LoVerde
 * All rights reserved.
 *
 * Donations:  https://paypal.me/KurtisLoVerde/10
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     1. This software may not be used by any for-profit entity, whether a
 *        business, person, or other, or for any for-profit purpose.
 *     2. Redistributions of source code must retain the above copyright
 *        notice, this list of conditions and the following disclaimer.
 *     3. Redistributions in binary form must reproduce the above copyright
 *        notice, this list of conditions and the following disclaimer in the
 *        documentation and/or other materials provided with the distribution.
 *     4. Neither the name of the copyright holder nor the names of its
 *        contributors may be used to endorse or promote products derived from
 *        this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

"use strict";function RealtimeMonitor(){function b(Ib){const Jb=document.createElement("canvas"),Kb=Jb.getContext("2d");return Jb.width=Ib.width,Jb.height=Ib.height,Kb.drawImage(Ib,0,0,Ib.width,Ib.height),Jb.toDataURL("image/"+Ib.src.replace(/^.*\./,""))}function c(){return"Notification"in window?"denied"===Notification.permission||"blocked"===Notification.permission?void(Gb=!1):"granted"===Notification.permission?void(Gb=!0):void("default"===Notification.permission&&Notification.requestPermission(function(Ib){"granted"===Ib&&(Gb=!0)})):(Fb=!1,void(Gb=!1))}function d(Ib,Jb){const Kb=document.createElement("span");return Kb.id=Ib+Jb,Kb.className="graphColor",Kb.classList.add(Jb),Kb}function e(Ib,Jb,Kb,Lb){const Mb=document.createElement("div");return Mb.id=Ib+Jb,Mb.className="applicationMenuItem",Mb.appendChild(document.createTextNode(Kb)),Mb.addEventListener("click",function(){Lb(),w(Ib)}),Mb}function h(Ib,Jb,Kb,Lb,Mb){const Nb=document.createElement("div"),Ob=document.createElement("label"),Pb=document.createElement("span");let Qb=null,Rb=null;return Nb.className="fieldContainer",Ib===db?(Jb=bb+Jb,Lb="Lowest"+" "+Lb,Rb=xa):Ib===eb?(Jb=ab+Jb,Lb="Highest"+" "+Lb,Rb=xa):Ib===cb&&(Qb=document.createElement("div"),Qb.id=Kb+Pa+Jb,Qb.className="status",Nb.classList.add("currentValue"),Nb.classList.add("hasGraph"),Nb.appendChild(Qb),Ob.addEventListener("click",function(){y(Kb+Ka+Jb)})),Pb.id=Kb+Jb,Rb&&(Ob.className="highLowLabel",Pb.className=Rb),Ob.id=Ja+Pb.id,Ob.setAttribute("for",Pb.id),Ob.appendChild(document.createTextNode(Lb+":")),Nb.appendChild(Ob),Nb.appendChild(Pb),Mb&&Nb.appendChild(k(Rb,Mb,Jb,Kb)),Nb}function k(Ib,Jb,Kb,Lb){const Mb=document.createElement("span");return Mb.id=Lb+Qa+Kb,Mb.className=na,Ib&&Mb.classList.add(Ib),Mb.appendChild(document.createTextNode(Jb)),Mb}function l(){const Ib=document.createElement("div");return Ib.className="fieldSeparator",Ib}function m(Ib,Jb,Kb){const Lb=document.createElement("canvas"),Mb=Lb.getContext("2d");Lb.id=Ib+Ka+Jb,Lb.className=oa;const Nb=new Chart(Mb,{type:"line",data:{datasets:[{label:"",data:[],backgroundColor:p(Ib),borderColor:q(Ib),borderWidth:1}]},options:{legend:{display:!1},title:{display:!0,text:Kb,position:"top",fontColor:o(Ib)},tooltips:{mode:"point",displayColors:!1},elements:{line:{tension:0}},animation:{duration:0},hover:{animationDuration:0}}});return{canvas:Lb,graph:Nb}}function n(Ib){const Jb=document.getElementById(Ib+ka);return Jb?window.getComputedStyle(Jb).getPropertyValue("background-color"):[]}function o(Ib){const Jb=document.getElementById(Ib+ja);return Jb?window.getComputedStyle(Jb).getPropertyValue("background-color"):[]}function p(Ib){const Jb=document.getElementById(Ib+ha);return Jb?window.getComputedStyle(Jb).getPropertyValue("background-color"):[]}function q(Ib){const Jb=document.getElementById(Ib+ia);return Jb?window.getComputedStyle(Jb).getPropertyValue("background-color"):[]}function r(Ib){if(Fb){const Jb=document.getElementById(Ib+Ga).innerText;t(Ib,Jb!==Ta)}else alert("Notifications are not supported by your browser.  To make use of notification functionality, you'll need to install a supporting browser, such as a recent version of Firefox or Chrome.")}function t(Ib,Jb){const Kb=document.getElementById(Ib+Ga);Kb.innerText=Jb?Ta:"Unmute Notifications",yb[Ib].notifications=Jb}function u(Ib){const Jb=document.getElementById(Ib+Ba),Kb=document.getElementById(Ib+Ca);Kb&&Jb&&(Kb.classList.contains(na)?(Kb.classList.remove(na),Jb.classList.add(_)):(Kb.classList.add(na),Jb.classList.remove(_)))}function w(Ib){const Jb=document.getElementById(Ib+Ba),Kb=document.getElementById(Ib+Ca);Kb&&(Kb.classList.add(na),Jb.classList.remove(_))}function x(Ib){const Jb=document.getElementById(Ib+za),Kb=document.getElementById(Ib+Fa);Jb.classList.contains(qa)?(Jb.classList.remove(qa),Kb.innerHTML=Ra):(Jb.classList.add(qa),Kb.innerHTML="Maximize",w(Ib))}function y(Ib){const Jb=document.getElementById(Ib),Kb=Jb.parentNode;for(let Lb=0;Lb<Kb.childNodes.length;Lb++){const Mb=Kb.childNodes[Lb].classList;Mb.contains(oa)||Mb.add(oa)}Jb.classList.remove(oa)}function z(Ib){const Jb=document.getElementById(Ib+Ea),Kb=-1!==Jb.innerHTML.indexOf(Xa);Kb?B(Ib,!1):A(Ib)}function A(Ib){function Jb(Lb){I(Ib);const Mb=JSON.parse(Lb);K(Ib,Mb),M(Ib)}const Kb=yb[Ib].url;if(Ab[pb]||(Ab[pb]=window.setInterval(function(){for(let Lb in Cb){const Mb=Cb[Lb];for(let Nb in Mb){const Ob=Mb[Nb].canvas;if(R(Ob)){L(Lb,Nb);break}}}},3e3)),!Ab[Ib])if("GET"===Kb.method||"POST"===Kb.method)Ab[Ib]=window.setInterval(function(){"GET"===Kb.method?E(Kb.address,Jb):"POST"===Kb.method&&F(Kb.address,Kb.postData,Jb)},1e3*Kb.pollInterval);else if("websocket"===Kb.method){const Lb=new WebSocket(Kb.address);Bb[Ib]=Lb,Lb.onopen=function(){Db[Ib]=mb,U(Kb.wsGreeting)&&Lb.send(JSON.stringify(Kb.wsGreeting))},Lb.onclose=function(Mb){Db[Ib]!==ob&&(0<=yb[Ib].url.wsCloseCodes.indexOf(Mb.code)?C(Ib,15):Db[Ib]=nb)},Lb.onmessage=function(Mb){Jb(Mb.data)}}document.getElementById(Ib+Ea).innerHTML=Xa}function B(Ib,Jb){if(!Jb){const Lb=qb+Ib;U(Ab[Lb])&&(window.clearInterval(Ab[Lb]),Ab[Lb]=void 0,Bb[Ib].onclose=void 0),Db[Ib]=nb,Hb[Ib]&&(Hb[Ib].close(),Hb[Ib]=void 0)}U(Ab[Ib])&&(window.clearInterval(Ab[Ib]),Ab[Ib]=void 0),U(Bb[Ib])&&((0===Bb[Ib].readyState||1===Bb[Ib].readyState)&&Bb[Ib].close(vb),Bb[Ib]=void 0);const Kb=document.getElementById(Ib+Ea);Kb&&(Kb.innerHTML=Wa)}function C(Ib,Jb){const Lb=qb+Ib;U(Ab[Lb])||(Db[Ib]=ob,Ab[Lb]=setInterval(function(){0<Jb&&Db[Ib]!==nb?(H(Ib,"Connection lost.  Reconnecting...("+Jb+")"),console.log("Reconnecting... attempts remaining: "+Jb),B(Ib,!0),A(Ib),Jb=Db[Ib]===mb?0:Jb-1):0==Jb&&(clearInterval(Ab[Lb]),Db[Ib]===mb?Ab[Lb]=void 0:(H(Ib,"Connection lost - could not reconnect"),B(Ib,!1)))},7e3))}function E(Ib,Jb){const Kb=G("GET",Ib,Jb);Kb.send()}function F(Ib,Jb,Kb){const Lb=G("POST",Ib,Kb);Lb.setRequestHeader("Content-Type","application/x-www-form-urlencoded");const Mb=Object.keys(Jb).map(function(Nb){return encodeURIComponent(Nb)+"="+encodeURIComponent(Jb[Nb])}).join("&");Lb.send(Mb)}function G(Ib,Jb,Kb){const Lb=new XMLHttpRequest;return Lb.open(Ib,Jb),Lb.setRequestHeader("X-Requested-With","XMLHttpRequest"),Lb.onreadystatechange=function(){4===Lb.readyState&&200===Lb.status&&"function"==typeof Kb&&Kb(Lb.responseText)},Lb}function H(Ib,Jb){const Kb=document.getElementById(Ib+Ia);Kb.innerText=Jb,Kb.classList.remove(oa)}function I(Ib){const Jb=document.getElementById(Ib+Ia);Jb.classList.add(oa),Jb.innerText=""}function J(Ib){B(Ib,!1);const Jb=document.getElementById(Ib);Jb&&Jb.parentNode.removeChild(Jb),zb[Ib]=void 0,yb[Ib]=void 0}function K(Ib,Jb){const Kb=zb[Ib];for(let Lb in Jb)if(T(Kb[Lb])){const Mb=bb+Lb,Nb=ab+Lb;Kb[Lb]=Jb[Lb],Kb[Mb]=null===Kb[Mb]||Kb[Mb]>Kb[Lb]?Kb[Lb]:Kb[Mb],Kb[Nb]=null===Kb[Nb]||Kb[Nb]<Kb[Lb]?Kb[Lb]:Kb[Nb]}}function L(Ib,Jb){const Kb=Cb[Ib][Jb].graph,Lb=Kb.data.datasets[0],Mb=o(Ib),Nb=n(Ib);Chart.defaults.global.defaultFontColor=Mb,Kb.options.title.fontColor=Mb,Kb.options.scales.xAxes[0].gridLines.color=Nb,Kb.options.scales.yAxes[0].gridLines.color=Nb,Lb.backgroundColor=p(Ib),Lb.borderColor=q(Ib),Kb.update()}function M(Ib){function Jb(Rb,Sb,Tb){const Ub=Rb+Ka+Sb,Vb=Cb[Rb][Ub].graph,Wb=Vb.data.datasets[0],Xb=Wb.data,Yb=Vb.data.labels;L(Rb,Ub),35===Xb.length&&(Yb.shift(),Xb.shift()),Vb.data.labels.push(""),Xb.push(Tb),Vb.update()}function Kb(Rb,Sb){let Tb=sa;return U(Rb)&&U(Rb.danger)&&Sb<=Rb.danger?Tb=ua:U(Rb)&&U(Rb.warn)&&Sb<=Rb.warn&&(Tb=ta),Tb}function Lb(Rb,Sb){let Tb=sa;return U(Rb.danger)&&Sb>=Rb.danger?Tb=ua:U(Rb.warn)&&Sb>=Rb.warn&&(Tb=ta),Tb}const Mb=zb[Ib],Nb=document.getElementById(Ib+Aa);let Ob=!1,Pb=!1,Qb=!1;for(let Rb in Mb){const Sb=Rb.replace(/^(lowest|highest)/,""),Tb=yb[Ib].lowThresholds[Sb],Ub=yb[Ib].highThresholds[Sb],Vb=Mb[Rb],Wb=document.getElementById(Ib+Rb);if(Qb=!Qb&&(U(Tb)||U(Ub)),Wb){const Xb=document.getElementById(Ja+Ib+Rb),Yb=0===Rb.indexOf(bb),Zb=!Yb&&0===Rb.indexOf(ab),$b=!Zb&&!Yb,_b=document.getElementById(Ib+Pa+Rb);let ac=null,bc=null,cc=Tb||Ub?sa:va;Xb.title="",Wb.innerHTML="",Wb.appendChild(document.createTextNode(Vb)),$b&&(!yb[Ib].fields[Rb].showLowest&&(Xb.title+="lowest: "+zb[Ib][bb+Rb]),!yb[Ib].fields[Rb].showHighest&&(Xb.title+=(yb[Ib].fields[Rb].showLowest?"":", ")+"highest: "+zb[Ib][ab+Rb])),Tb&&(ac=Kb(Tb,Vb),ac===ta?$b&&(Ob=!0):ac===ua&&$b&&(Pb=!0)),Ub&&(bc=Lb(Ub,Vb),bc===ta?$b&&(Ob=!0):bc===ua&&$b&&(Pb=!0)),(ac===ta||bc===ta)&&(cc=ta),(ac===ua||bc===ua)&&(cc=ua),_b&&N(_b,cc);const dc=document.getElementById(Ib+Qa+Rb);dc&&dc.classList.remove(na),Yb||Zb?(N(Wb,cc),dc&&N(dc,cc)):Jb(Ib,Rb,Vb)}}Nb.classList.remove(sa),Nb.classList.remove(ta),Nb.classList.remove(ua),Qb?Pb?(Nb.classList.add(ua),yb[Ib].notifications&&P(gb,Ib)):Ob?(Nb.classList.add(ta),yb[Ib].notifications&&P(fb,Ib)):Nb.classList.add(sa):Nb.classList.add(va)}function N(Ib,Jb){Ib.classList.remove(sa),Ib.classList.remove(ta),Ib.classList.remove(ua),Ib.classList.add(Jb)}function O(Ib){Hb[Ib.target.data.panelId]=null}function P(Ib,Jb){let Kb=Hb[Jb];const Lb=!U(Kb),Mb=!Lb&&Kb.data.type<Ib;if(Lb||Mb){Mb&&(Kb.removeEventListener("close",O),Kb.close(),Kb=null);let Nb,Ob,Pb,Qb=new Date;const Tb=Qb.toLocaleDateString({year:"numeric",month:"long",day:"numeric"}),Ub=Qb.toLocaleTimeString({hour12:!0}),Vb=Tb+" "+Ub;if(Ib===fb)Nb=rb[sb],Ob="Warning:  "+yb[Jb].title,Pb=yb[Jb].title+" reached a warning threshold on "+Vb;else if(Ib===gb)Nb=rb[tb],Ob="Danger:  "+yb[Jb].title,Pb=yb[Jb].title+" reached a danger threshold on "+Vb;else throw new Error("Invalid threshold notification type");const Wb=Q(Ib,Jb,Nb,Ob,Pb,"threshold"+Jb,!0);Wb.addEventListener("close",O),Hb[Jb]=Wb}}function Q(Ib,Jb,Kb,Lb,Mb,Nb,Ob){let Pb=null;if(c(),Gb){Pb=new Notification(Lb,{body:Mb,icon:Kb,tag:Nb,data:{type:Ib,panelId:Jb},requireInteraction:Ob})}return Pb}function R(Ib){return!Ib.classList.contains(oa)&&!Ib.classList.contains(na)}function S(Ib,Jb){function Kb(Ob,Pb,Qb,Rb){if(Rb&&!U(Ob))throw new Error("Invalid configuration:  property '"+Pb+"' is required");if(U(Ob))if("array"===Qb){if(!Array.isArray(Ob))throw new Error("Invalid configuration:  property '"+Pb+"' must be of type '"+Qb+"' but is '"+typeof Ob+"'");}else if(typeof Ob!==Qb)throw new Error("Invalid configuration:  property '"+Pb+"' must be of type '"+Qb+"' but is '"+typeof Ob+"'")}const Lb="Invalid configuration:  ";if(!Ib)throw new Error("panelId has no value");if(!Jb)throw new Error(Lb+"no configuration was provided");const Mb={};Mb.url={},Mb.url.pollInterval=ub,Mb.lowThresholds={},Mb.highThresholds={},Mb.autoConnect=!0,Mb.startMinimized=!1,Mb.notifications=!0,Mb.fields={},Mb.lowThresholds={},Mb.highThresholds={},Kb(Jb.title,"title","string",!0),Mb.title=Jb.title,Kb(Jb.url,"url","object",!0),Kb(Jb.url.address,"url.address","string",!0),Mb.url.address=Jb.url.address;let Nb=null;if(0===Jb.url.address.indexOf("http://")||0===Jb.url.address.indexOf("https://")){if(Kb(Jb.url.method,"url.method","string",!0),Nb=Jb.url.method.toUpperCase(),"GET"!==Nb&&"POST"!==Nb)throw new Error(Lb+"url.method must be GET or POST");Mb.url.method=Nb}else if(0===Jb.url.address.indexOf("ws://")||0===Jb.url.address.indexOf("wss://")){if(U(Jb.url.method))throw new Error(Lb+"url.method is not used with websocket URLs");if(Mb.url.method="websocket",Kb(Jb.url.wsGreeting,"url.wsGreeting","object",!1),Mb.url.wsGreeting=Jb.url.wsGreeting,Kb(Jb.url.wsCloseCodes,"url.wsCloseCodes","array",!1),Jb.url.wsCloseCodes){for(let Ob=0;Ob<Jb.url.wsCloseCodes.length;Ob++){const Pb="url.wsCloseCodes["+Ob+"]";if(Kb(Jb.url.wsCloseCodes[Ob],Pb,"number",!0),Jb.url.wsCloseCodes[Ob]===vb)throw new Error(Lb+Pb+" cannot be "+vb+" (normal closure)")}Mb.url.wsCloseCodes=Jb.url.wsCloseCodes}else Mb.url.wsCloseCodes=[]}else throw new Error(Lb+"unknown protocol in URL "+Jb.url.address);if("POST"===Nb){if(Kb(Jb.url.postData,"url.postData","object",!0),!Jb.url.postData||1>Object.keys(Jb.url.postData).length)throw new Error(Lb+"url.method is POST but url.postData is undefined or has no length");Mb.url.postData=Jb.url.postData}Kb(Jb.url.pollInterval,"url.pollInterval","number",!1),U(Jb.url.pollInterval)&&Jb.url.pollInterval>ub&&(Mb.url.pollInterval=Jb.url.pollInterval),Kb(Jb.autoConnect,"autoConnect","boolean",!1),U(Jb.autoConnect)&&(Mb.autoConnect=Jb.autoConnect),Kb(Jb.startMinimized,"startMinimized","boolean",!1),U(Jb.startMinimized)&&(Mb.startMinimized=Jb.startMinimized),Kb(Jb.notifications,"notifications","boolean",!1),U(Jb.notifications)&&(Mb.notifications=Jb.notifications),Kb(Jb.fields,"fields","object",!0);for(let Ob=0;Ob<Jb.fields.length;Ob++){const Pb=Jb.fields[Ob],Qb="fields["+Ob+"]";Kb(Pb.prop,Qb+".prop","string",!0),Mb.fields[Pb.prop]={},Kb(Pb.label,Qb+".label","string",!0),Mb.fields[Pb.prop].label=Pb.label,Kb(Pb.suffix,Qb+".suffix","string",!1),Pb.suffix&&(Mb.fields[Pb.prop].suffix=Pb.suffix);const Rb=Pb.lowThresholds,Sb=Pb.highThresholds;if(Kb(Rb,Qb+".highThresholds","object",!1),Rb){if(Kb(Rb.warn,Qb+".lowThresholds.warn","number",!1),Kb(Rb.danger,Qb+".lowThresholds.danger","number",!1),!Rb.warn&&!Rb.danger)throw new Error(Lb+Qb+".lowThresholds must define .warn, .danger or both");Mb.lowThresholds[Pb.prop]=Rb}if(Kb(Sb,Qb+".highThresholds","object",!1),Sb){if(Kb(Sb.warn,Qb+".highThresholds.warn","number",!1),Kb(Sb.danger,Qb+".highThresholds.danger","number",!1),!Sb.warn&&!Sb.danger)throw new Error(Lb+Qb+".highThresholds must define .warn, .danger or both");Mb.highThresholds[Pb.prop]=Sb}Kb(Pb.showLowest,Qb+".showLowest","boolean",!1),Mb.fields[Pb.prop].showLowest=!U(Pb.showLowest)||Pb.showLowest,Kb(Pb.showHighest,Qb+".showHighest","boolean",!1),Mb.fields[Pb.prop].showHighest=!U(Pb.showHighest)||Pb.showHighest}return Mb}function T(Ib){return"undefined"!=typeof Ib}function U(Ib){const Jb="undefined"==typeof Ib;let Kb=!1;return Jb||(Kb=null===Ib),!Jb&&!Kb}const _="menuActive",ha="graphFillColor",ia="graphEdgeColor",ja="graphLabelColor",ka="graphGridColor",na="visibilityHidden",oa="visibilityGone",qa="minimized",sa="normal",ta="warn",ua="danger",va="none",xa="highLowValue",ya="realtimeMonitorPanel",za="panelBody",Aa="title",Ba="titleBarControls",Ca="appMenu",Ea="menuItemConnect",Fa="menuItemMinMax",Ga="menuItemNotif",Ia="statusBar",Ja="label",Ka="graph",Pa="status",Qa="suffix",Ra="Minimize",Ta="Mute Notifications",Wa="Connect",Xa="Disconnect",ab="highest",bb="lowest",cb=0,db=1,eb=2,fb=0,gb=1,mb=1,nb=2,ob=3,pb="graphThemeRefresh",qb="reconnect",rb=[],sb="THRESHOLD_NOTIFICATION_ICON_WARN",tb="THRESHOLD_NOTIFICATION_ICON_DANGER",ub=3,vb=1e3,yb={},zb={},Ab=[],Bb=[],Cb=[],Db=[];let Eb=0,Fb=!0,Gb=!1,Hb=[];(function(Ib,Jb){for(let Kb=0;Kb<Jb.length;Kb++){const Lb=new Image;Lb.src=Jb[Kb][1],Lb.onload=function(){Ib[Jb[Kb][0]]=b(Lb)}}})(rb,[[sb,"img/notification-warn.png"],[tb,"img/notification-danger.png"]]),c(),window.addEventListener("beforeunload",function(){for(let Ib in yb)B(Ib,!1)}),this.newPanel=function(Ib){function Jb(Wb){Wb.originalTarget!==Nb&&Wb.srcElement!==Nb&&w(Kb.id)}const Kb=document.createElement("div");Kb.id=ya+Eb,Kb.className="monitoringPanel",zb[ya+Eb]=zb[ya+Eb]||[],yb[Kb.id]=S(Kb.id,Ib);const Lb=document.createElement("div");Lb.id=Kb.id+Aa,Lb.className="titleBar",Lb.addEventListener("dblclick",function(){x(Kb.id)});const Mb=document.createElement("div");Mb.className="titleBarTitle",Mb.appendChild(document.createTextNode(Ib.title)),Lb.appendChild(Mb);const Nb=document.createElement("div");Nb.id=Kb.id+"appMenuBtn",Nb.className="appMenuButton",Nb.addEventListener("click",function(){u(Kb.id)}),Nb.addEventListener("dblclick",function(Wb){Wb.stopPropagation()}),Kb.addEventListener("click",function(Wb){Jb(Wb)}),document.addEventListener("click",function(Wb){Jb(Wb)});const Ob=document.createElement("div");Ob.id=Kb.id+Ba,Ob.appendChild(Nb),Ob.classList.add("titleBarControls"),Lb.appendChild(Ob),Kb.appendChild(Lb);const Pb=document.createElement("div");Pb.id=Kb.id+Ca,Pb.className="applicationMenu",Pb.classList.add(na),Pb.appendChild(e(Kb.id,Ea,Wa,function(){z(Kb.id)})),Pb.appendChild(e(Kb.id,Fa,Ra,function(){x(Kb.id)})),Pb.appendChild(e(Kb.id,Ga,Ta,function(){r(Kb.id)})),Pb.appendChild(e(Kb.id,"menuItemClose","Close Panel",function(){J(Kb.id)})),Lb.appendChild(Pb);const Qb=document.createElement("div");Qb.id=Kb.id+za,Qb.className="panelBody";const Rb=document.createElement("div");Rb.id=Kb.id+Ia,Rb.classList.add("statusBar"),Rb.classList.add(oa),Qb.appendChild(Rb);const Sb=document.createElement("div");Sb.className="fieldsContainer";for(let Wb=0;Wb<Ib.fields.length;Wb++){const Xb=Ib.fields[Wb];Sb.appendChild(h(cb,Xb.prop,Kb.id,Xb.label,Xb.suffix)),yb[Kb.id].fields[Xb.prop].showLowest&&Sb.appendChild(h(db,Xb.prop,Kb.id,Xb.label,Xb.suffix)),yb[Kb.id].fields[Xb.prop].showHighest&&Sb.appendChild(h(eb,Xb.prop,Kb.id,Xb.label,Xb.suffix)),zb[ya+Eb][Xb.prop]=null,zb[ya+Eb][bb+Xb.prop]=null,zb[ya+Eb][ab+Xb.prop]=null,Sb.appendChild(l());const Yb=m(Kb.id,Xb.prop,Xb.label+(U(Xb.suffix)?" ("+Xb.suffix+")":""));Cb[Kb.id]=Cb[Kb.id]||[],Cb[Kb.id][Yb.canvas.id]=Yb}Qb.appendChild(Sb);const Tb=document.createElement("div");Tb.className="graphContainer",Qb.appendChild(Tb);let Ub=!0;for(let Wb in Cb[Kb.id]){const Xb=Cb[Kb.id][Wb].canvas;Ub&&Xb.classList.remove(oa),Tb.appendChild(Xb),Ub=!1}Tb.appendChild(d(Kb.id,ha)),Tb.appendChild(d(Kb.id,ia)),Tb.appendChild(d(Kb.id,ja)),Tb.appendChild(d(Kb.id,ka)),Kb.appendChild(Qb);let Vb=new MutationObserver(function(Wb){Wb.forEach(function(Xb){for(let Yb=0;Yb<Xb.addedNodes.length;Yb++)Xb.addedNodes[Yb].id===Kb.id&&(Ib.startMinimized&&x(Kb.id),t(Kb.id,yb[Kb.id].notifications),yb[Kb.id].autoConnect&&z(Kb.id),Vb.disconnect(),Vb=void 0)})});return Vb.observe(document.body,{childList:!0}),Db[Kb.id]=nb,Eb++,Kb}}